# 答案10：代码改错 - 数组越界

## 错误分析

### 错误1：循环条件错误
- **位置**：`for (int i = 0; i <= 5; i++)`
- **问题**：数组大小为5，有效索引是0-4，但循环到了5（越界）
- **后果**：访问 `arr[5]` 是未定义行为，可能读取到垃圾数据或导致程序崩溃

### 错误2：负数索引
- **位置**：`arr[-1]`
- **问题**：数组索引不能为负数
- **后果**：未定义行为，可能导致程序崩溃

### 错误3：超出范围访问
- **位置**：`arr[10]`
- **问题**：数组大小只有5，索引10超出范围
- **后果**：未定义行为

## 修正后的代码

```cpp
#include <iostream>
#include <vector>
using namespace std;

int main() {
    int arr[5] = {1, 2, 3, 4, 5};
    
    // 修正1：循环条件改为 i < 5
    for (int i = 0; i < 5; i++) {  // 修正：i < 5 而不是 i <= 5
        cout << arr[i] << " ";
    }
    cout << endl;
    
    // 修正2：删除或修正负数索引访问
    // 如果要访问最后一个元素，应该用 arr[4]
    cout << "Last element: " << arr[4] << endl;
    
    // 修正3：删除或添加边界检查
    int index = 10;
    if (index >= 0 && index < 5) {  // 边界检查
        cout << arr[index] << endl;
    } else {
        cout << "Index out of range!" << endl;
    }
    
    // 更好的方法：使用vector和at()方法
    vector<int> vec = {1, 2, 3, 4, 5};
    try {
        cout << vec.at(2) << endl;  // 安全访问
        // cout << vec.at(10) << endl;  // 会抛出异常
    } catch (const out_of_range& e) {
        cout << "Index out of range: " << e.what() << endl;
    }
    
    return 0;
}
```

## 详细解析

### 数组索引规则

1. **有效索引范围**：
   - 数组大小为 `n`，有效索引是 `[0, n-1]`
   - 例如：`int arr[5]` 的有效索引是 0, 1, 2, 3, 4

2. **常见错误**：
   ```cpp
   int arr[5];
   arr[5] = 10;   // ❌ 越界！有效索引最大是4
   arr[-1] = 10;  // ❌ 负数索引！
   ```

### 循环中的数组访问

**错误写法**：
```cpp
for (int i = 0; i <= 5; i++) {  // ❌ 会访问arr[5]，越界！
    cout << arr[i];
}
```

**正确写法**：
```cpp
for (int i = 0; i < 5; i++) {  // ✅ 只访问0-4
    cout << arr[i];
}
```

**更安全的写法**（使用size）：
```cpp
const int SIZE = 5;
int arr[SIZE];
for (int i = 0; i < SIZE; i++) {  // 使用常量，避免硬编码
    cout << arr[i];
}
```

### 数组越界的危害

1. **读取越界**：
   - 可能读取到垃圾数据
   - 可能读取到其他变量的值
   - 可能导致程序逻辑错误

2. **写入越界**：
   - 可能覆盖其他变量的值
   - 可能导致程序崩溃
   - 可能破坏程序栈，导致安全漏洞

### 如何避免数组越界

#### 方法1：使用vector和at()方法

```cpp
#include <vector>
vector<int> vec = {1, 2, 3, 4, 5};

// at()方法会进行边界检查
try {
    cout << vec.at(2) << endl;  // 安全
    cout << vec.at(10) << endl; // 抛出异常
} catch (const out_of_range& e) {
    cout << "Error: " << e.what() << endl;
}
```

#### 方法2：手动边界检查

```cpp
int index = 10;
if (index >= 0 && index < array_size) {
    cout << arr[index] << endl;
} else {
    cout << "Index out of range!" << endl;
}
```

#### 方法3：使用范围for循环（C++11）

```cpp
vector<int> vec = {1, 2, 3, 4, 5};
for (int x : vec) {  // 自动处理边界，不会越界
    cout << x << " ";
}
```

### 常见错误总结

| 错误代码 | 正确代码 | 说明 |
|---------|---------|------|
| `i <= size` | `i < size` | 循环条件 |
| `arr[size]` | `arr[size-1]` | 最后一个元素 |
| `arr[-1]` | 不要使用负数 | 负数索引无效 |
| 无边界检查 | 添加if判断 | 动态索引需要检查 |

### 最佳实践

1. **使用vector代替数组**：更安全，功能更强大
2. **使用at()方法**：自动进行边界检查
3. **使用范围for循环**：避免手动管理索引
4. **添加边界检查**：如果必须使用数组，添加边界检查
5. **使用常量定义大小**：避免硬编码数字

