# 答案04：代码阅读 - 智能指针

## 正确答案

```
=== unique_ptr ===
Resource 1 created
p1 exists
Resource 1 destroyed
p1 out of scope

=== shared_ptr ===
Resource 2 created
p2 use_count: 1
p3 created, p2 use_count: 2
p3 out of scope, p2 use_count: 1
Resource 2 destroyed
p2 out of scope
```

## 解析

### unique_ptr部分

1. **创建unique_ptr**：
   - `make_unique<Resource>(1)` 创建Resource对象，输出：`Resource 1 created`
   - unique_ptr独占所有权

2. **作用域结束**：
   - p1离开作用域时，**自动调用析构函数**
   - 输出：`Resource 1 destroyed`

### shared_ptr部分

1. **创建shared_ptr**：
   - `make_shared<Resource>(2)` 创建Resource对象，输出：`Resource 2 created`
   - 引用计数为1，输出：`p2 use_count: 1`

2. **复制shared_ptr**：
   - `p3 = p2` 共享所有权，引用计数+1
   - 输出：`p3 created, p2 use_count: 2`

3. **p3离开作用域**：
   - 引用计数-1，变为1
   - 输出：`p3 out of scope, p2 use_count: 1`
   - **对象未销毁**（因为p2还在使用）

4. **p2离开作用域**：
   - 引用计数变为0，**对象被销毁**
   - 输出：`Resource 2 destroyed`

### 关键知识点
- **unique_ptr**：
  - 独占所有权，不能复制，只能移动
  - 离开作用域自动销毁
  
- **shared_ptr**：
  - 共享所有权，使用引用计数
  - 引用计数为0时自动销毁
  - `use_count()` 返回当前引用计数

- **RAII原则**：资源获取即初始化，自动管理内存

### 常见错误
- 误以为shared_ptr复制会增加对象数量（实际是共享同一个对象）
- 不理解引用计数的变化时机

